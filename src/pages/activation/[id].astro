---
import BorderedLayout from "@/layouts/BorderedLayout.astro";
import { Logo } from "@/components/Logo";
import { Navbar } from "@/components/Navbar";
import { Button } from "@/components/ui/button";
import Footer from "@/components/Footer.astro";
import { GET } from "@/pages/api/get-payment/[id].ts";
import { renderSVG } from "uqr";
import { FAQ } from "@/components/FAQ";
import { ActivationInfo } from "@/components/ActivationInfo";
import type { GetPaymentResponse } from "@/types";

export const prerender = false;

const { pathname } = Astro.url;
const { id } = Astro.params;
const paymentReq = await GET(Astro);

if (!paymentReq.body) return new Response(null, { status: 404 });

const payment = (await paymentReq.json()) as GetPaymentResponse;

const qrCode = renderSVG(payment.payAddress || "", {
  blackColor: "#554289",
  ecc: "Q",
});
---

<title>Marz | Activation & Checkout</title>
<BorderedLayout>
  <div class="px-6 flex gap-2 items-center border-b p-5">
    <Logo />
    <Navbar currentPathname={pathname} />
    <a href="/#pricing" class="hidden md:flex">
      <Button>Get Started</Button>
    </a>
  </div>

  <main>
    <div class="w-full px-4 py-8 md:p-14">
      <div class="flex flex-col md:items-center justify-center gap-2">
        <h2
          class="text-2xl md:text-4xl font-medium md:text-center text-balance pb-1"
        >
          Activation & Checkout
        </h2>
        <p
          class="text-muted-foreground md:text-center md:text-balance md:max-w-3xl"
        >
          Boost your users experience by integrating Marz into your VPN service.
        </p>
      </div>
    </div>
    <ActivationInfo
      client:idle
      qrCode={qrCode}
      initialPaymentData={payment}
      invoiceId={id!}
    />
  </main>
  <hr class="pb-16" />
  <FAQ client:visible />
  <Footer />
</BorderedLayout>
